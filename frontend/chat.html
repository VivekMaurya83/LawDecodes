<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LawDecodes - AI Chat</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./chat.css">
  <!-- NEW: Library for code syntax highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>

<body>
  <div class="app-container">
    <aside class="sidebar">
      <!-- (Sidebar content is unchanged) -->
      <div class="sidebar-header">
        <h1 class="brand">LawDecodes</h1>
      </div>
      <div class="sidebar-content">
        <button id="newChatBtn" class="new-chat-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>New Chat</button>
        <nav class="chat-history">
          <h4 class="history-title">History</h4>
          <ul id="chatList" class="chat-list"></ul>
        </nav>
      </div>
      <div class="sidebar-footer">
        <a href="./profile.html" class="profile-link" title="Manage Profile">
          <div class="profile-section">
            <div class="avatar-container"><svg class="avatar" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" />
                <path
                  d="M12 15C14.2091 15 16 13.2091 16 11C16 8.79086 14.2091 7 12 7C9.79086 7 8 8.79086 8 11C8 13.2091 9.79086 15 12 15Z"
                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                <path d="M19.0002 19.5C19.0002 16.4624 15.8662 14 12.0002 14C8.13418 14 5.00024 16.4624 5.00024 19.5"
                  stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              </svg></div>
            <div class="profile-info">
              <div id="username-display" class="username">Loading...</div>
              <div class="user-status">Standard Plan</div>
            </div>
          </div>
        </a>
      </div>
    </aside>

    <main class="chat-area">
      <header class="top-bar">
        <!-- (Top bar content is unchanged) -->
        <div class="chat-meta"><span id="chatName" class="chat-name"></span><span id="saveStatus"
            class="save-status"></span></div>
        <div class="top-bar-controls">
          <button id="theme-toggle-btn" class="icon-btn" title="Toggle theme"><svg class="moon-icon"
              xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
            </svg><svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="5"></circle>
              <line x1="12" y1="1" x2="12" y2="3"></line>
              <line x1="12" y1="21" x2="12" y2="23"></line>
              <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
              <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
              <line x1="1" y1="12" x2="3" y2="12"></line>
              <line x1="21" y1="12" x2="23" y2="12"></line>
              <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
              <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
            </svg></button>
          <a id="exitBtn" href="./MainHomePage.html" class="exit-btn">Exit</a>
        </div>
      </header>
      <div id="chatWindow" class="chat-window">
        <!-- NEW: Empty Chat State -->
        <div id="emptyChat" class="empty-chat-container">
          <div class="empty-chat-logo">LawDecodes</div>
          <h2>How can I help you today?</h2>
          <p>Upload a document to get started. You can ask for a summary, find legal terms, or ask specific questions
            about the content.</p>
        </div>
      </div>
      <div class="chat-input-area">
        <!-- (Chat input form is unchanged) -->
        <form id="chatInputForm" class="chat-input-form" onsubmit="return false;">
          <div class="input-wrapper">
            <label class="icon-btn file-upload-label" title="Attach file"><svg xmlns="http://www.w3.org/2000/svg"
                width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path
                  d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48">
                </path>
              </svg><input type="file" id="fileInput"></label>
              <button type="button" id="pasteTextBtn" class="icon-btn file-upload-label" title="Paste text" style="left: 3.5rem;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"></path><rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect></svg>
            </button>
            <input type="text" id="chatInput" placeholder="Ask a question or type /clear..." required>
          </div>
          <button type="submit" class="send-btn icon-btn" title="Send message"><svg xmlns="http://www.w3.org/2000/svg"
              width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
              stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"></line>
              <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
            </svg></button>
        </form>
      </div>
    </main>
  </div>

  <!-- MODIFIED: SIDE-BY-SIDE COMPARISON MODAL with EXPORT button -->
  <div id="comparisonModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Compare Document and Summary</h2>
        <div> <!-- Button container -->
          <button id="exportDocxBtn" class="action-btn">Export to DOCX</button>
          <button id="closeModalBtn" class="close-button">&times;</button>
        </div>
      </div>
      <div class="comparison-container">
        <div class="comparison-panel">
          <h3>Original Extracted Text</h3>
          <!-- FIXED: Changed <pre> to <div> for proper content rendering -->
          <div class="comparison-content" id="originalTextContent">Loading...</div>
        </div>
        <div class="comparison-panel">
          <h3>Generated Summary</h3>
          <!-- FIXED: Changed <pre> to <div> for proper HTML rendering -->
          <div class="comparison-content" id="summaryTextContent">Loading...</div>
        </div>
      </div>
    </div>
  </div>

  <div id="pasteTextModal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Paste Your Document Text</h2>
        <button id="closePasteModalBtn" class="close-modal-btn">&times;</button>
      </div>
      <div class="modal-body">
        <textarea id="pasteTextArea" placeholder="Paste your raw legal text here..."></textarea>
      </div>
      <div class="modal-footer">
        <button id="submitPasteBtn" class="modal-submit-btn">Analyze Pasted Text</button>
      </div>
    </div>
  </div>

  <!-- NEW: Libraries for Markdown Parsing and Highlighting -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

  <script src="./chat.js"></script>
</body>

</html>